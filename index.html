<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Bloom - Data Monitoring Center</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css?v=3.2">
</head>
<body>
    <div class="container">
        <button id="langBtn" class="btn-lang">ğŸŒ ä¸­æ–‡</button>

        <div class="top-row">
            <div class="card title-card">
                <h1>ğŸ® Memory Bloom</h1>
                <p class="subtitle" data-i18n="subtitle">Real-time Game Data Monitoring & Analysis System</p>
                <p class="version-info" data-i18n="version">System Version v3.3.0 (i18n-separated)</p>
            </div>

            <div class="card note-card">
                <h2 data-i18n="nursingNotes">ğŸ’¬ Nursing Communication Log</h2>
                
                <div id="chatHistory" class="chat-history-box">
                    <div class="chat-placeholder" data-i18n="noLogs">No records yet...</div>
                </div>

                <div class="chat-input-area">
                    <div class="role-selector-container">
                        <label for="noteRole" data-i18n="roleLabel">Role:</label>
                        <select id="noteRole" class="role-select">
                            <option value="Nurse" data-i18n="roleNurse">ğŸ‘©â€âš•ï¸ Nurse</option>
                            <option value="Doctor" data-i18n="roleDoctor">ğŸ‘¨â€âš•ï¸ Doctor</option>
                            <option value="Therapist" data-i18n="roleTherapist">ğŸ§˜ Therapist</option>
                            <option value="Family" data-i18n="roleFamily">ğŸ  Family</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <textarea id="sysMsgInput" placeholder="Enter message..."></textarea>
                        <button id="sendMsgBtn" data-i18n="sendBtn">Send</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin-bottom: 0; border: none;" data-i18n="deviceCenter">ğŸ“± Device Management Center</h2>
                <button onclick="openReportModal()" class="btn-report" id="reportBtn" style="display: none;" data-i18n="genReport">
                    ğŸ“„ Generate Medical Report
                </button>
            </div>
            
            <div class="device-toolbar">
                <div class="device-list" id="deviceList">
                    <div class="loading" data-i18n="searchingDev">Searching for devices in Firebase...</div>
                </div>

                <div class="control-panel" id="remoteControls" style="display: none;">
                    <div class="panel-title" data-i18n="remoteCtrl">Remote Control</div>
                    <div class="status-indicator">
                        <span data-i18n="diffLabel">Difficulty:</span> <span id="currentDiff" class="diff-badge">--</span>
                    </div>
                    <div class="btn-group">
                        <button class="btn-ctrl btn-easy" onclick="setDifficulty(0)">Easy</button>
                        <button class="btn-ctrl btn-hard" onclick="setDifficulty(1)">Hard</button>
                        <button class="btn-ctrl btn-auto" onclick="setDifficulty(2)">Auto</button>
                    </div>
                    <span id="cmdStatus" class="cmd-feedback"></span>
                </div>
            </div>
        </div>

        <div class="dashboard">
            <div class="card">
                <h2 data-i18n="cumulativeData">ğŸ“Š Cumulative Data</h2>
                <div class="stat-group">
                    <div class="stat-item">
                        <div class="stat-number" id="totalGames">0</div>
                        <div class="stat-label" data-i18n="totalSessions">Total Sessions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="highScore">0</div>
                        <div class="stat-label" data-i18n="highScore">High Score</div>
                    </div>
                </div>
            </div>

            <div class="card chart-card">
                <h2 data-i18n="recentPerf">ğŸ“ˆ Recent Performance</h2>
                <div class="chart-container">
                    <canvas id="scoreChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h2 data-i18n="latestSession">ğŸ¯ Latest Session</h2>
                <div class="stat-number" id="latestScore">0</div>
                <div class="stat-label" data-i18n="scoreLabel">Score</div>
                <div id="latestMode" style="font-weight: bold; margin-bottom: 5px; color: #0277bd;">--</div>
                <div id="latestTime" style="color: #666; font-size: 0.85em;">--:--:--</div>
                <div style="margin-top: 15px;">
                    <span data-i18n="statusLabel">Status:</span> <span id="connectionStatus" class="status-offline" data-i18n="waitingData">Waiting for data...</span>
                </div>
            </div>
        </div>

        <div class="card table-card">
            <h2 data-i18n="detailedRecords">ğŸ“‹ Detailed Records List</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th data-i18n="colTime">Time</th>
                            <th data-i18n="colMode">Mode</th>
                            <th data-i18n="colScore">Score</th>
                            <th data-i18n="colDuration">Duration</th>
                            <th>Session ID</th>
                        </tr>
                    </thead>
                    <tbody id="recordsBody">
                        <tr><td colspan="5" class="loading" data-i18n="selectDevPrompt">Please select a device...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer>
        <p>Memory Bloom | Firebase Realtime Sync | <span data-i18n="lastUpdate">Last Update</span>: <span id="lastUpdate">--:--:--</span></p>
    </footer>

    <div id="reportModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="rptModalTitle">ğŸ“‹ Cognitive Training Analysis Report</h3>
                <span class="close-btn" onclick="closeReportModal()">&times;</span>
            </div>
            
            <div id="printableArea" class="report-body">
                <div class="report-title-section">
                    <h2 id="rpt-title-main">Memory Bloom Cognitive Function Report</h2>
                    <p id="rpt-title-sub">Cognitive Function Monitoring Report</p>
                </div>
                <hr>
                <div class="report-info">
                    <p><strong data-i18n="rptUser">User/Device:</strong> <span id="rpt-device-name">--</span></p>
                    <p><strong data-i18n="rptTime">Generated Time:</strong> <span id="rpt-date">--</span></p>
                    <p><strong data-i18n="rptCount">Data Samples:</strong> <span id="rpt-sample-count">0</span> <span data-i18n="rptSessions">sessions</span></p>
                </div>

                <div class="report-section">
                    <h4 data-i18n="rptAnalysisHeader">ğŸ“Š Comprehensive Performance Analysis</h4>
                    <p id="rpt-summary-text" class="analysis-text">Analyzing data...</p>
                </div>

                <div class="report-section">
                    <h4 data-i18n="rptSuggestionHeader">ğŸ’¡ Doctor/AI Suggestions (Rule-based)</h4>
                    <ul id="rpt-suggestions" class="suggestion-list">
                        <li>Generating suggestions...</li>
                    </ul>
                </div>
                
                <div class="report-section">
                    <h4 data-i18n="rptLogHeader">ğŸ“ Recent Nursing Logs</h4>
                    <ul id="rpt-note-list" class="report-msg-list">
                    </ul>
                </div>
                
                <div class="report-footer">
                    <p data-i18n="rptDisclaimer">This report is automatically generated by Memory Bloom system for reference only and does not serve as a formal medical diagnosis.</p>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeReportModal()" data-i18n="btnClose">Close</button>
                <button class="btn-download" onclick="downloadPDF()" data-i18n="btnDownload">ğŸ“¥ Download PDF Report</button>
            </div>
        </div>
    </div>

    <script src="en.js"></script>
    <script src="zh-hk.js"></script>
    <script src="script.js?v=3.3"></script>
</body>
</html>
